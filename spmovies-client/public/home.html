<!doctype html>
<html class="no-js" lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>SP Movies: Home </title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="shortcut icon" type="image/x-icon" href="assets/img/favicon.ico">

		<!-- CSS here -->
            <link rel="stylesheet" href="assets/css/bootstrap.min.css">
            <link rel="stylesheet" href="assets/css/slicknav.css">
            <link rel="stylesheet" href="assets/css/flaticon.css">
            <link rel="stylesheet" href="assets/css/fontawesome-all.min.css">
            <link rel="stylesheet" href="assets/css/themify-icons.css">
            <link rel="stylesheet" href="assets/css/nice-select.css">
            <link rel="stylesheet" href="assets/css/home.css">
   </head>

   <body>
    <header>
        <!-- Header Start -->
       <div class="header-area header-transparent">
            <div class="main-header">
               <div class="header-bottom  header-sticky">
                    <div class="container-fluid">
                        <div class="row align-items-center">
                            <!-- Logo -->
                            <div class="col-xl-2 col-lg-2 col-md-1">
                                <div class="logo">
                                  <a href="home.html"><img src="assets/img/sp_white_logo.png" class="w-75 h-50 "alt=""></a>
                                </div>
                            </div>
                            <div class="col-xl-10 col-lg-10 col-md-8">
                                <!-- Main-menu -->
                                <div class="main-menu f-right d-none d-lg-block">
                                    <nav>
                                        <ul id="navigation">   
                                            <li id="adminDashboard"></li>                                                                                                                                  
                                            <li><a href="Home.html">Home</a></li>
                                            <li><a href="#">Genres</a>
                                                <ul class="submenu" id="genres">
                                                </ul>
                                            </li>
                                            <li><a href="#">Movies</a>
                                                <ul class="submenu" id="movies">
                                                </ul>
                                            </li>
                                            <li class="login" id="loginlogout">
                                            </li>
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                            <!-- Mobile Menu -->
                            <div class="col-12">
                                <div class="mobile_menu d-block d-lg-none"></div>
                            </div>
                        </div>
                    </div>
               </div>
            </div>
       </div>
        <!-- Header End -->
    </header>
    <main>

        <!-- Hero Area Start-->
        <div class="slider-area hero-overly">
            <div class="single-slider hero-overly  slider-height d-flex align-items-center">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-xl-8 col-lg-9">
                            <!-- Hero Caption -->
                            <div class="hero__caption">
                                <span>Welcome to SP Movies</span>
                                <h1>Discover New Movies</h1>
                            </div>
                            <!--Hero form -->
                            <form action="#" class="search-box">
                                <div class="input-form">
                                    <input type="text" oninput="myFunction()" class="form-control" list="searchResult" name="search" id="search" placeholder="What are you looking for?" value="">
                                    <datalist id="searchResult">
                                        
                                    </datalist>
                                </div> 
                                <div class="select-form">
                                    <div class="select-itms">
                                        <select name="select" id="select1" onchange="selectSearchType()">
                                            <option value="Title">Title</option>
                                            <option value="Genre">Genre</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="search-form">
                                    <button id="submitSearch">Search</button>
                                </div>	
                            </form>	
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <!--Hero Area End-->
        <!-- Popular Movies Start -->
        <div class="popular-location section-padding30">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <!-- Section Title -->
                        <div class="section-tittle text-center mb-80">
                            <h2>Popular Movies</h2>
                        </div>
                    </div>
                </div>
                <div class="row" id="moviePoster">
                </div>
            </div>
        </div>
        <!-- Popular Movies End -->

    </main>
    <footer>
        <!-- Footer Start-->
        <div class="footer-area">
            <div class="container">
               <div class="footer-top footer-padding">
                    <div class="row justify-content-between">
                        <div class="col-xl-3 col-lg-4 col-md-4 col-sm-6">
                            <div class="single-footer-caption mb-50">
                                <div class="single-footer-caption mb-30">
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-2 col-lg-2 col-md-4 col-sm-">
                            <div class="single-footer-caption mb-50">
                                <div class="footer-tittle">
                                    <h4>Quick Link</h4>
                                    <ul>
                                        <li><a href="home.html">Home</a></li>
                                        <li><a href="searchResults.html">Search</a></li>
                                        <li><a href="profile.html">Profile</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-lg-3 col-md-4 col-sm-6">
                            <div class="single-footer-caption mb-50">
                                <div class="footer-tittle">
                                    <h4>Download App</h4>
                                    <ul>
                                        <li class="app-log"><a href="#"><img src="assets/img/gallery/app-logo.png" alt=""></a></li>
                                        <li><a href="#"><img src="assets/img/gallery/app-logo2.png" alt=""></a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
               </div>
                <div class="footer-bottom">
                    <div class="row d-flex justify-content-between align-items-center">
                        <div class="col-xl-9 col-lg-8">
                            <div class="footer-copy-right">
                                <p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
  Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="fa fa-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
  <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></p>
                            </div>
                        </div>
                        <div class="col-xl-3 col-lg-4">
                            <!-- Footer Social -->
                            <div class="footer-social f-right">
                                <a href="#"><i class="fab fa-facebook-f"></i></a>
                                <a href="#"><i class="fab fa-twitter"></i></a>
                                <a href="#"><i class="fas fa-globe"></i></a>
                                <a href="#"><i class="fab fa-instagram"></i></a>
                            </div>
                        </div>
                    </div>
               </div>
            </div>
        </div>
        <!-- Footer End-->
    </footer>
    <!-- Scroll Up -->
    <div id="back-top" >
        <a title="Go to Top" href="#"> <i class="fas fa-level-up-alt"></i></a>
    </div>


        <!-- JS here -->
		<!-- All JS Custom Plugins Link Here here -->
        <script src="assets/js/modernizr-3.5.0.min.js"></script>
		<!-- Jquery, Popper, Bootstrap -->
		<script src="assets/js/jquery-3.2.1.min.js"></script>
        <script src="assets/js/popper.min.js"></script>
        <script src="assets/js/bootstrap.min.js"></script>
	    <!-- Jquery Mobile Menu -->
        <script src="assets/js/jquery.slicknav.min.js"></script>

		<!-- Jquery Slick , Owl-Carousel Plugins -->
        <!-- <script src="assets/js/owl.carousel.min.js"></script> -->
        <script src="assets/js/slick.min.js"></script>
		<!-- One Page, Animated-HeadLin -->
        <script src="assets/js/wow.min.js"></script>
		<!-- <script src="assets/js/animated.headline.js"></script> -->
        <!-- <script src="assets/js/jquery.magnific-popup.js"></script> -->

		<!-- Nice-select, sticky -->
        <script src="assets/js/jquery.nice-select.min.js"></script>
		<script src="assets/js/jquery.sticky.js"></script>
        
		<!-- Jquery Plugins, main Jquery -->	
        <script src="assets/js/plugins.js"></script>
        
        <!-- Calling js file that contains ajax functions -->
        <script src="assets/js/ajax/ajax.js"></script>
        <script>headerAjaxCall()</script>
        <script src="assets/js/main.js"></script>
        
        <script>
            // searchtype identifies whether users are searching by movie title or genre
            var searchType;
            function selectSearchType (){
                searchType = document.getElementById("select1").value;
            }

            // check if user clicked a datalist option and append to search box if they did
            function myFunction() {
                var searchValue = document.getElementById("search").value; // user input
                var options = document.getElementById('searchResult').childNodes;
                for (var j = 0; j < options.length; j++) {
                    if (options[j].value === searchValue) {
                        $("#search").attr("value",options[j].value);
                    }
                }
            }

            $(document).ready(function() {
                console.log("Ready triggered");
                var movieTitleArr = []

                // to display movie poster and title in home page
                // ajax to get all movie data
                $.ajax({
                    url: 'http://localhost:3000/movie/' ,
                    type: 'GET',
                    success: function (movieInfo, textStatus, xhr) {
                        // for loop + ajax to append movie posters
                        for(var i = 0; i < 6; i++) {
                            var movieID = movieInfo[i].movieid;
                            var movieTitle = movieInfo[i].title;
                            $.ajax({
                                url: `http://localhost:3000/retrieve/${movieID}/poster/`,
                                type: 'GET',
                                async: false,
                                success: function (data, textStatus, xhr) {
                                    console.log("Get movie poster success");
                                    var appendMovieImageHTML = `<div class="col-lg-4 col-md-6 col-sm-6">
                                                                    <div class="single-location mb-30">
                                                                        <div class="location-img">
                                                                            <img src="${data.moviePoster_url}" alt="">
                                                                        </div>
                                                                        <div class="location-details" id="movieTitle">
                                                                            <p>${movieTitle}</p><a onClick="movieClick(${movieID})" class="location-btn"><i class="ti-plus"></i> Details</a>
                                                                        </div>
                                                                    </div>
                                                                </div>`
                                    $('#moviePoster').append(appendMovieImageHTML);
                                }, // end of success for retrieve movie poster
                                error: function (xhr, textStatus, errorThrown) {
                                    console.log('Error in Operation');
                                    alert(xhr.responseJSON.Message);
                                } // end of error function
                            }); // end of ajax
                        }; // end of for loop
                    }, // end of success for get all movie data
                    error: function(xhr, textStatus, errorThrown) {
                        console.log('Error in Operation');  
                        alert(xhr.responseJSON.Message);
                    } // end of error
                }); // end of ajax

                // handles user searching
                $("#submitSearch").click(function () {
                    console.log("Submit search was clicked");
                    // gets user search
                    var userSearchInput = $('#search').val();

                    // set user search in local storage and redirects them to search results page
                    if (searchType == "Genre") {
                        localStorage.removeItem('userSearchInput');
                        localStorage.setItem('userSearchGenre',userSearchInput);
                        window.location.assign("http://localhost:3001/searchResults.html");
                        return false;
                    } else {
                        localStorage.removeItem('userSearchGenre');
                        localStorage.setItem('userSearchInput',userSearchInput);
                        window.location.assign("http://localhost:3001/searchResults.html");
                        return false;
                    }
                }); // end of submit search event handler

                // live searching, appends similar results from user input to datalist
                $("#search").keyup(function() {
                    var userInput = $("#search").val();
                    if (userInput == "") {
                        $("#searchResult").html("");
                    } else {
                        var data = "{\"userSearch\":\"" + userInput + "\"}";
                        $.ajax({
                            url: `http://localhost:3000/searchMovie/${userInput}/`,
                            type: 'GET',
                            data: data,
                            contentType: "application/json; charset=utf-8",
                            dataType: "json",
                            success: function (data, textStatus, xhr) {
                                if(data == []) {
                                    $("#searchResult").html("");
                                } else {
                                    $(".options").remove();
                                    data.forEach((data) => {
                                        var appendSearchResultsHTML = `<option class="options" value="${data.title}"></option>`;
                                        $("#searchResult").append(appendSearchResultsHTML);
                                    }); // end of foreach
                                }
                            }, // end of success
                            error: function(xhr, textStatus, errorThrown) {
                                console.log('Error in Operation');  
                                alert(xhr.responseJSON.Message);
                            }
                        }); // end of ajax
                    } // end of if else
                }); // end of search event handler

            }); // end of document ready
        </script>
    </body>
</html>